<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
  </head>
  <body onLoad="scrollDiv_init()" style="padding-top: 65px">
    <!-- Displayed on top of a potentially large JSON response, so it will remain visible -->
    <div>
      {% include ['nav.html'] %}
      <div>
        <div class="container">
          <div class="row">
            <div class="col-md-6">
              <form>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      >Encrypted file Extension</span
                    >
                  </div>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="example .89z8g"
                    id="encrypted_file_extension"
                    value=""
                  />
                  <div class="input-group-append">
                    <div class="dropdown btn-group" role="group">
                      <button
                        class="btn btn-outline-primary dropdown-toggle"
                        data-toggle="dropdown"
                        aria-expanded="false"
                        type="button"
                        value="DEV"
                        id="mode"
                      >
                        DEV
                      </button>
                      <div class="dropdown-menu">
                        <a
                          class="dropdown-item"
                          style="cursor: pointer"
                          id="selectDevMode"
                          >DEV</a
                        ><a
                          class="dropdown-item"
                          style="cursor: pointer"
                          id="selectProdMode"
                          >PROD</a
                        >
                      </div>
                    </div>
                    <button
                      class="btn btn-outline-primary"
                      id="submit_restore"
                      type="button"
                    >
                      Start Now!
                    </button>
                  </div>
                </div>
              </form>
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">
                    Restore {{ user.get("preferred_username") }}&#39;s Drive
                  </h4>
                  <h6 class="text-muted card-subtitle mb-2">
                    Restore Date: {{ data.restore_date.strftime('%m-%d-%Y
                    %H:%M:%S %Z') }}<br />
                  </h6>
                  <p class="card-text">
                    <strong>Note:</strong> Enter the encrypted file extension in
                    the input field above. Two modes are available (DEV, PROD). 
                    DEV mode will run in logging only mode.  PROD mode will
                    restore and rename files based on the extension and date
                    above.
                  </p>
                </div>
              </div>
            </div>
            <div class="col" style="text-align: center">
              <img src="/static/img/onedrive.png" />
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0">Logging</h5>
                </div>
                <div id="logging-text" class="card-body">
                  <p>paragraph 1</p>
                  <p>paragraph 2</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Just a generic json viewer -->
    </div>
    <script language="javascript">
      document.getElementById("selectDevMode").onclick = function () {
        document.getElementById("mode").innerHTML = "DEV";
        document.getElementById("mode").value = "DEV";
      };
      document.getElementById("selectProdMode").onclick = function () {
        document.getElementById("mode").innerHTML = "PROD";
        document.getElementById("mode").value = "PROD";
      };

      function setLoading() {
        document.getElementById("submit_restore").disabled = true;
        document.getElementById("submit_restore").innerHTML = "Loading...";
      }

      function clearLoading() {
        document.getElementById("submit_restore").disabled = false;
        document.getElementById("submit_restore").innerHTML = "Start Now!";
      }

      document.getElementById("submit_restore").onclick = function () {
        setLoading();
        let data = {
          mode: document.getElementById("mode").value,
          encrypted_file_extension: document.getElementById(
            "encrypted_file_extension"
          ).value,
        };

        const url = "restore";
        fetch(url, {
          method: "POST",
          headers: { "Content-type": "application/json;charset=UTF-8" },
          body: JSON.stringify(data),
        })
          .then((response) => response.text())
          .then((html) => alert(`response: ${html}`))
          .then(clearLoading());
      };

      ScrollRate = 100;

      function scrollDiv_init() {
        DivElmnt = document.getElementById("logging-text");
        ReachedMaxScroll = false;

        DivElmnt.scrollTop = 0;
        PreviousScrollTop = 0;

        ScrollInterval = setInterval("scrollDiv()", ScrollRate);
      }

      function scrollDiv() {
        if (!ReachedMaxScroll) {
          DivElmnt.scrollTop = PreviousScrollTop;
          PreviousScrollTop++;

          ReachedMaxScroll =
            DivElmnt.scrollTop >= DivElmnt.scrollHeight - DivElmnt.offsetHeight;
        } else {
          ReachedMaxScroll = DivElmnt.scrollTop == 0 ? false : true;

          DivElmnt.scrollTop = PreviousScrollTop;
          PreviousScrollTop--;
        }
      }

      function pauseDiv() {
        clearInterval(ScrollInterval);
      }

      function resumeDiv() {
        PreviousScrollTop = DivElmnt.scrollTop;
        ScrollInterval = setInterval("scrollDiv()", ScrollRate);
      }
    </script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
